// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

import "forge-std/console.sol";

library BuildMerkleRoot {
    function buildRoot(bytes32[] memory leaves) public view returns (bytes32) {
        require(leaves.length > 0, "Length of leaves must be > 0");
        if (leaves.length == 1) return leaves[0];

        uint256 nextLevelLength = leaves.length % 2 == 0 ? leaves.length / 2 : leaves.length / 2 + 1;
        bytes32[] memory nextLevel = new bytes32[](nextLevelLength);

        for (uint256 i = 0; i < leaves.length / 2; i++) {
            nextLevel[i] = keccak256(abi.encode(leaves[2 * i], leaves[(2 * i) + 1]));
        }

        if (leaves.length % 2 == 1) {
            nextLevel[nextLevelLength - 1] = keccak256(abi.encode(leaves[leaves.length - 1], leaves[leaves.length - 1]));
        }

        return buildRoot(nextLevel);
    }

    function buildSubtree(bytes32[] memory leaves, uint256 key) public pure returns (bytes32[] memory subtree) {}

    function emptySparseMerkleTree(uint256 levels) public pure returns (bytes32[] memory hashes) {
        require(levels != 0 && levels < 257);
        hashes = new bytes32[](levels);

        hashes[0] = keccak256(abi.encode(0));

        for (uint256 i = 1; i < levels; i++) {
            hashes[i] = keccak256(abi.encode(hashes[i - 1], hashes[i - 1]));
        }
    }

    function emptySparseMerkleTree160() external pure returns (bytes32[160] memory hashes) {
        for (uint256 i = 0; i < 160; i++) {
            for (uint256 j = 0; j < 32; j++) {
                hashes[i] = hashes[i] | bytes32(sparse160[32 * i + j]) >> j * 8;
            }
        }
    }

    bytes constant sparse160 = hex"290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563"
        hex"633dc4d7da7256660a892f8f1604a44b5432649cc8ec5cb3ced4c4e6ac94dd1d"
        hex"890740a8eb06ce9be422cb8da5cdafc2b58c0a5e24036c578de2a433c828ff7d"
        hex"3b8ec09e026fdc305365dfc94e189a81b38c7597b3d941c279f042e8206e0bd8"
        hex"ecd50eee38e386bd62be9bedb990706951b65fe053bd9d8a521af753d139e2da"
        hex"defff6d330bb5403f63b14f33b578274160de3a50df4efecf0e0db73bcdd3da5"
        hex"617bdd11f7c0a11f49db22f629387a12da7596f9d1704d7465177c63d88ec7d7"
        hex"292c23a9aa1d8bea7e2435e555a4a60e379a5a35f3f452bae60121073fb6eead"
        hex"e1cea92ed99acdcb045a6726b2f87107e8a61620a232cf4d7d5b5766b3952e10"
        hex"7ad66c0a68c72cb89e4fb4303841966e4062a76ab97451e3b9fb526a5ceb7f82"
        hex"e026cc5a4aed3c22a58cbd3d2ac754c9352c5436f638042dca99034e83636516"
        hex"3d04cffd8b46a874edf5cfae63077de85f849a660426697b06a829c70dd1409c"
        hex"ad676aa337a485e4728a0b240d92b3ef7b3c372d06d189322bfd5f61f1e7203e"
        hex"a2fca4a49658f9fab7aa63289c91b7c7b6c832a6d0e69334ff5b0a3483d09dab"
        hex"4ebfd9cd7bca2505f7bef59cc1c12ecc708fff26ae4af19abe852afe9e20c862"
        hex"2def10d13dd169f550f578bda343d9717a138562e0093b380a1120789d53cf10"
        hex"776a31db34a1a0a7caaf862cffdfff1789297ffadc380bd3d39281d340abd3ad"
        hex"e2e7610b87a5fdf3a72ebe271287d923ab990eefac64b6e59d79f8b7e08c46e3"
        hex"504364a5c6858bf98fff714ab5be9de19ed31a976860efbd0e772a2efe23e2e0"
        hex"4f05f4acb83f5b65168d9fef89d56d4d77b8944015e6b1eed81b0238e2d0dba3"
        hex"44a6d974c75b07423e1d6d33f481916fdd45830aea11b6347e700cd8b9f0767c"
        hex"edf260291f734ddac396a956127dde4c34c0cfb8d8052f88ac139658ccf2d507"
        hex"6075c657a105351e7f0fce53bc320113324a522e8fd52dc878c762551e01a46e"
        hex"6ca6a3f763a9395f7da16014725ca7ee17e4815c0ff8119bf33f273dee11833b"
        hex"1c25ef10ffeb3c7d08aa707d17286e0b0d3cbcb50f1bd3b6523b63ba3b52dd0f"
        hex"fffc43bd08273ccf135fd3cacbeef055418e09eb728d727c4d5d5c556cdea7e3"
        hex"c5ab8111456b1f28f3c7a0a604b4553ce905cb019c463ee159137af83c350b22"
        hex"0ff273fcbf4ae0f2bd88d6cf319ff4004f8d7dca70d4ced4e74d2c74139739e6"
        hex"7fa06ba11241ddd5efdc65d4e39c9f6991b74fd4b81b62230808216c876f827c"
        hex"7e275adf313a996c7e2950cac67caba02a5ff925ebf9906b58949f3e77aec5b9"
        hex"8f6162fa308d2b3a15dc33cffac85f13ab349173121645aedf00f471663108be"
        hex"78ccaaab73373552f207a63599de54d7d8d0c1805f86ce7da15818d09f4cff62"
        hex"cf277fb80a82478460e8988570b718f1e083ceb76f7e271a1a1497e5975f53ae"
        hex"4bf6ffa2bc131204513289738567a68fa9f4827dac7fd3b3d1f2e94777d57f36"
        hex"b49d61e8c2c894e12486176ab8f4d7069d6692fa6495541567872e7ecbddb726"
        hex"202b1014739f29b1d905d630ddeb8560a32bf23e666c8a1523a4a600227fef7c"
        hex"9e1d1ce5cdca9cdf40fa5786548b58eb19ddfd32395b4582983919099dbd1531"
        hex"13784d01e2fae904de62c6fbf9776979ca7a2777ae2632ee278d19aca30f890e"
        hex"68c477f83a13a000ad2b5b3e50375b7c3ae782d987ba4b5a65376bbb97469fb3"
        hex"71e37864edf08740d592362cd24d0db067bf14cd3b97bd2a68e782adffb43655"
        hex"88d0cc35e8abe7d6524569be8aa1a48bb23362326fdfefe961348bc96091c94c"
        hex"8545f2c1afdace5d87f06ce1d44bc0a2691aea4414d0ad640be0d9879c8374d9"
        hex"2360c4480d69879eadd7ae508409f2f0ba83a2b0fe0da57b40008c064d2c397d"
        hex"31763a8e1dedb15ad0c8b88d437fef835aeb958292644810663dc1756550f22b"
        hex"fa4c9b1172ab5afebd159573e19e25169975242e10a2ed38dfc805232fb50a64"
        hex"3528594d65e9525233b39587174bcf0bba562d95b50b429914c7e0e8a9ae58f9"
        hex"1765922797ba721e8937c7470a26d5c2f141f3d4106447dab171fced7d652a69"
        hex"f0573e660ba01cff272a1c6f7927d73c94c85d380a84399867626d6429d48bae"
        hex"31682c19f715cd317da1a553ce384de6902fe26032fecc7de03e40502af05dce"
        hex"d50c6062bfcd7bbd0dbd68d1ddeeae095485720a1ce334e9e5e5153066f42260"
        hex"e0bcfbd03fa4a619a5bc3cae15404f39b4b7bf5ddd5161ea642d13d23baef545"
        hex"acb98b6fb1a5fdae0a5718d0b812e1de1412e44d875146acc1a7f7c3916c003a"
        hex"bb1ff291eb2e614a661d6730b502bae2bde112958cee698478845a1bb3788a6b"
        hex"9a91f4c19545d6cd9720d4736591fe70edcf3e33cb2e56f21fdc1244f3d2ef6d"
        hex"bdf82c7d252d69c64bd6fa8ee66ad9d30241016981e4580e3c2edc4804b75236"
        hex"63bc3b9e8340ab48a66828d7d9d7d5be2f5f280665196d25a39c4d01345cb95e"
        hex"a962e4bd7d1f316f845784e115ff103530d85f9dfacd638ad45fbe938ba85c40"
        hex"b3f100a0f506f6a6c86c10f107ab4811ddc76f72516fcdfa8a0c9bd71ff912ab"
        hex"e7e8dbc3898515970ca6fce19039ca22ae2638e44b24641fd61048b94dc2be25"
        hex"31d0f66ab43019856780cb246cfd37b0c190d17111d5c016f19ba715ee622dc5"
        hex"acd2f3dfd43e9a01bc64a9c4ac8ac8a2b29f3274131a12010b42b8c830e879bf"
        hex"a231361ad3389fe6f2b62a46cf677d6c5f7b79964c30a2c34aa4fc3392f501c9"
        hex"140ab49cc3bb44e342655a521185933b2230ec274ff5304b2cead9873a822863"
        hex"10c710f9205b30e8a7163edbfcd85e8fbaf2f3fe442f2ee4af580e28b2df1180"
        hex"6f35419d1da1260bc0f33d52e8f6d73fc5d672c0dca13bb960b4ae1adec17937"
        hex"72050228e76eea36eb63b3819cf423f39f7621dbc55cd5ac95b8085ed72ac18d"
        hex"1b9c04182065b1b245775830cd0a7d16d5b5ac30003a75ba2da82d41998b75bd"
        hex"66c748fa1fa46286a584d5e32ec3e6df85d227ef94f8ce5edf1a058ce0ada3bb"
        hex"1204d6d36acf0c62d34b018a5773af701dfe2ec554a2feb61fd4f9d1d6c4dfae"
        hex"c1ce5cd9116e59ce80baef228aa9104d50a8afaa8732713b645872acc2a51fc2"
        hex"27528eeada7809ec96fa25238661ac169617d23da9d7ff276ba29742caf29ada"
        hex"2888beb332475f18a777d1f39098fc12541681b963f65dedec5429bfece3210a"
        hex"d4fa9f86887e680b80cf80b3ef2477f2a2bbc224bbd1b97d3e42155f65aec01e"
        hex"75cc3f60d8ed678cf3d4494cccbd49c76fd5b480e429533c80e5e60d3ee6a004"
        hex"22e7d0c00166e50acd6babf7098332ae6c6357fdd539cd8ec827e25ff550c0ea"
        hex"8714300a06ded1bbc93fb21d36d5c7322e0f15436b8672751baf7e7cb4ae2a27"
        hex"16157d2bd58a7b95f6865223066637ecbff17547399b3410cba13bd6af3d549a"
        hex"90bd4c808cb7a55dee8d06c9eae7d20427dd02bf0e10d94fc17f475198815c76"
        hex"dd7603f6533970e4e3f499475dc861b125609bfc37b510306aed26eeda801dae"
        hex"720b709e155a65e44174b8ae8bd442b74752de080dc99093e3b9c90cd9665905"
        hex"df1113d54e2be174efbd89714d72315516cad06f46097706be1620ef4a80e100"
        hex"b06d2309f76d11ad92a63539a27f878084834c84456084aa805be035293b8278"
        hex"a19f51c3d2f4ef463e4c2143934878f7bef4d9117249bf274b1ebddc0b0de377"
        hex"7cb7386183ace5eb5d03cdd418096b736edeb38c2889b137d921f50995c6f868"
        hex"ebd4d8b1ea4f429b340b4c3c65015a983d56ad8c8d92f1487530cab1a9d5b04c"
        hex"ec4db68276cadf1e60947f8065dccc9fffac4fac803d7366272e8b9ac9437464"
        hex"a861a47a9501b55af3a5d953f5e1dfed6f4f00284be746608f4bf589fb9ca2ae"
        hex"be73c876cd5cc4c3d9996bc673e501e3edcc0636c02e5941ecfea40de207d59e"
        hex"a50c576e962d4c4b856fed8fc904f03f70ab1b7452b9a5e6b128daf3ca7f699f"
        hex"1d838d5b36f231876a74165632d1b9a68f85236d26d1a6dff5a7908bc2cc4e37"
        hex"a1988bad42c5bb223df55c77118330b1293876ec3dbaeb6317c0d0641539fbf2"
        hex"d268cadc429cfc62b46a044210fb3af2770d26859be18cdc1a596009b09122e7"
        hex"0dbd34275d12e4468a425a8901aa8ac70b20a375166b5255f591540b4ff3f442"
        hex"71009056c2cbc90f40977b03559837f27c3c40fb5f57a9ea535b25dbf9813146"
        hex"27e835b9443e90835ef68860748cacce58ee113a80b9bbd8699ba6018d90ad51"
        hex"58bfaa568325cba81e5ca7c8fa3ebd68d6b804b96fa44f6b2e22776e6e0f1413"
        hex"d19cb91caf32f40d82fdfe3f42152724b9978121ef152fafd238ec1a290f1226"
        hex"90e7b8eedd93b64e4ad449baf7af774045c400ff18880e40021a91cca921ed7e"
        hex"2cf28424be2a22f4ba47a509109c2d7c4cd94b322c4f4114ff1a88f0bd1fcec9"
        hex"a387b317833905653e25a3773f23af872fd3eb6b3c8a7b457a9e07e5fd774b50"
        hex"f579021c40d5c79fce7ab6dba30d1b21ee09314ed235160967e183909bd1009d"
        hex"d9f3e9094ff2bf0532253a610f6a31cd2070d37cc46aa2dbb267241e179d9a32"
        hex"df4796a3ebdef36f840325252e264b3ecd3b0cc96595d60e598235b910074569"
        hex"ef98b7260ff0e5c7dee8b16d1f8298252442b37b8df3e4d994895df8e454973b"
        hex"7c4549074fac4bb803439aa4aec0e2899161858a6d2233549465a9f19a4f9867"
        hex"efed2ec89ba08462bc419e788035da433d2c28ae05c7f085c4e1f9fd457155c3"
        hex"6d89a7c0a0b0f75111b0cbaf1496d186dd06b315baeeae7a86202924869eaf75"
        hex"6ecf4417b67fa62dead99bbe64405ad537db074a4e016766ade016f94ef23e18"
        hex"4ac056d1693c69e82a6a7d2176444d798c9f28b02333559173402abd5c86d963"
        hex"111a3b94341ffbef92e3d7fc5fbdba4e542e5b0936764467779d3f8105f470ff"
        hex"fb77d0a06a1ec39d3c2758d52b8e29bc1057237ccdd67ada6da34ab98e4d45e5"
        hex"68a9a9c5b6cace512bdb232c35d5c0b0bb9e4a21d0e672444e8750e04f7fa1c3"
        hex"7a71eefea1554df8a03d866a418759b9c86e3b8dc40297b38a0e84a4edfb9d39"
        hex"5d01a19ad43eb8318ee032bb2a0fb08b34ea93403ec97be4d5d95540b78afbec"
        hex"18de05ef18b48feb60aaee96438a759aa93c6e67e62c321749ba5c9c8381712e"
        hex"9f0376ce248aaee1f6b7bd019eabfe41dcf2f2791126d2066c4f18c7b4fc2ee5"
        hex"4defa253f768afbba78d8105336a420161ae292bf228aa0010c5efeb4f084dbe"
        hex"31f3fb62163f04d1aca5de58dade6de1050905d6e069505a382a7f333d7a12a6"
        hex"ba918dfe684b28e620e538a3ee4e7ad64e237dbb042e38926357690b7270c380"
        hex"8a3d3b797f8b23df8c683872e98cf1dfbd83f9b7486fef5606fe8b0c11d9a8c2"
        hex"c069e63b4107c4fe71cd431a53b237976dc673379c35e592f617c0ec074783ed"
        hex"2866fdd2824e33bd7484a3d374d60bbb60d17050467bfadecd08c98a3a188ae7"
        hex"9077ac10aeccc4113896a698303eeb897391e14a988746640387ce055341994d"
        hex"551f902eda78c0c4e09da6c6fe3c5c4a1664c95ce2d98c36c058d62fb14453c8"
        hex"c804817654d8ff66bd842a5f16f3140342611c701b095861b0eeadf887ccdc8f"
        hex"779b2c1e0b90396da261b79c57d642a593e4358c9ebd7f4cd846308ef7405737"
        hex"c51e16db0d4efc068760fe37b7fe930645c396ec0219febd28a0112ed980f372"
        hex"910fa776612f80c269c29cae69792dbd93643509d8c67d3425ac644655bf43c9"
        hex"8521b4ee8414b44019406cb6963b4dac52e96db9b8c74147196024ad8aab1fa6"
        hex"ab75f556a55876225d25d8ee1c3e3860a7a5ff00037cb68cd04a3664a9baddfa"
        hex"7593bdac15e211f10d8534310673cef09b5cdf67ff46cb9d84dc5f02f4d848c8"
        hex"29098c3528ca288a3ba5d20c50ce2fb33bb977a9441bbe6fd4a20ec329714c67"
        hex"f28f08fc33a4a0b0a120079a8c17f1c98349232c1a64771c131451eeef5103d3"
        hex"ba41e5a52b71aeb74ac39db74c3a828adb651ac5fb86cee4707a82e5e6030333"
        hex"ed13222c9ac540b5fcdc2c5439a772e62fc7a5d7e450b703ea356a158ddf6e8f"
        hex"f18891474d497c7d510ee3f48273fdbacf14722ccdd1bfe239c0dfc2d4b3046d"
        hex"74772a23245f98b1f247f8e1de703fea87bdb2819238ac6c19c154a68463a757"
        hex"8f7cdd107184bef0f66a2c862594178ffed1868e9a62ef827f414ff587418acc"
        hex"6d61a535827c9dfba926c8846d6aac31c83af3087902a6265182f0677bf4bd36"
        hex"7e94b6a5e7f7e34ce2375712f97f6a1304bcadc76f30be8acc65596d8ae5ce0a"
        hex"caa3990ab0ab3dda190dbc7b5fb745d26a75dc679ffd21281ea2f170921a6e93"
        hex"a86d19cb8c15d743f0f6de6ec5b217ab869adfed816355b901ca36e32c2735f5"
        hex"262411d5916f036612b30910f93bf08b3d8f3ebf4b2ede1ca8729a976e72f90b"
        hex"cdbd028b5e021f4d78eca87f92a81fc293741b80f80542a29c91e11bff4ec2ad"
        hex"fa4fed30de042337154b1876faff96ff476768fe6b33d60bd79f4d79a6723649"
        hex"d12676bee6c4758381e00e9dfc5efa26ce3f52e6e3de808cef329caad3b2111b"
        hex"930c3a6437966f293c5abe43d6755494ffeb61ddbb43122241668cae81eca6ec"
        hex"e553ea28aae7f551e4aa7f645f14f443352a60feb521f6eea1b33e57256989ee"
        hex"7a0ab1644240b224b2af4fbf75b5b72f776f9029f1eb442f22a004f2da65e9cd"
        hex"b4604f5bf9d4fd74610f970ebc7c37e7d16dbec98528c6c5707d36410b36685e"
        hex"26c2ad530442852abe097fcaf87adb094c5c4c69b29a1df3db974b8700346ed1"
        hex"22c601c9a5651a976c86fa5b577dc4a84b72c4f064c5dd299e9fd73f6efbe1f4"
        hex"498c1bd160f72532e2ca121927a66fb05a7e78824bd232003ae67e9b0a004aec"
        hex"02ce1bfb1fee99120a21d0b2a2237884fd86ec5e16eaa448edcee42cbdd621ff"
        hex"07fb644c4fdba075e861dc75105d8dfa7fe9a618c0aaad728cee06ae7e6c0c77"
        hex"5c9ade151a9f637f0ce3b3eb11fb0f83082fd22aa1952d0cd24ba2a73670bba7"
        hex"9d8666bfb31334525d66e56a10948add1bd0dd90d73161583d8e13d8b8fbeeaf"
        hex"7a01c5479954635b2d676e0cf1151a204b08576d437b8600f179f38eeb3e5e22"
        hex"1af4414e2867c09a324a0b0e84a0dbd40bbf15b3efa69b52ca8ca11b340ee095"
        hex"4b529be809997a3bb9e6aac629611bfe00c51044f4cb112a8b9b4ac7eab5c19a";
}
